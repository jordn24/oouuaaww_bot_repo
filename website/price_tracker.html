<!DOCTYPE HTML>
<!--
	Landed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
    <title>Price Tracker Bot</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="icon" href="images/8354.png">
    <link rel="stylesheet" href="assets/js/styles/default.css">
    <link rel="stylesheet" href="assets/js/styles/dracula.css">
    <script src="assets/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>
</head>

<body class="is-preload">
    <div id="page-wrapper">

        <!-- Header -->
        <!-- Header -->
        <header id="header">
            <span>
                <h1 style="margin-left:4%;" id="logo"><a href="index.html">Price Tracker Bot</a>
                </h1>
                <img style="float: left; padding-left: 1%;" src="images/8354.png" alt="" />
            </span>
            <nav id="nav">
                <ul>
                    <li><a href="#technologies">Technologies</a></li>
                    <li><a href="#commands">Commands</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a target="_blank"
                            href="https://discord.com/oauth2/authorize?client_id=844915211600920617&scope=bot&permissions=7784619969"
                            class="button primary">Invite Bot</a></li>
                </ul>
            </nav>
        </header>

        <!-- Main -->
        <div id="main" class="wrapper style1">
            <div class="container">
                <header class="major">
                    <h2> Price Tracker Bot</h2>
                    <p id="technologies">Node JS - Yahoo Finance API - CoinGecko API
                    </p>
                </header>

                <!-- Text -->
                <section>
                    <h3><a target="_blank" href="https://github.com/jordn24/investment-tracker-discord"
                            class="icon brands alt fa-github"> Github<span class="label"></span></a></h3>
                    <hr />
                    <header>
                        <h2>Technologies</h2>
                        <h3>Node.JS</h3>
                        <p>Node.js is an open-source, cross-platform, back-end JavaScript runtime environment that runs
                            on the V8 engine and executes JavaScript code outside a web browser.</p>
                    </header>
                    <header>
                        <h3>CoinGecko API</h3>
                        <p>The CoinGecko API allows us to retrieve cryptocurrency data such as price, volume, market
                            cap, and exchange data from CoinGecko using code.</p>
                    </header>
                    <header>
                        <h3>Yahoo Finance API</h3>
                        <p id="commands">The Yahoo Finance API is a range of libraries/APIs/methods to obtain historical
                            and real time
                            data for a variety of financial markets and products, as shown on Yahoo Finance.</p>
                        <hr />
                        <header>
                            <h2>Commands</h2>
                            <ul>
                                <li>!crypto [Coin Symbol]</li>
                                <li>!stock [Stock Ticker]</li>
                                <li>!random crypto</li>
                                <li id="about">!random stock</li>
                            </ul>
                        </header>
                        <hr />
                        <h2>About</h2>
                        <h3>Crypto Commands</h3>
                        <pre><code class="javascript">// CRYPTO DATA COMMAND
if (message.content.toLowerCase().includes(prefix + 'crypto ')){
    
    input = message.content.toLowerCase().substr(8)

    // Search with ticker
    data = await CoinGeckoClient.coins.list();
    length = data["data"].length
    coinId = "empty"
    for (var i = 0; i < length; i++) {
        if (data["data"][i]["symbol"] == input) {
            coinId = data["data"][i]["id"]
            coinName = data["data"][i]["name"]
        }
    }

    // If no ticker found
    if (coinId == "empty"){
        message.channel.send("Error: No coin found for ticker " + input)
        return
    }
    
    // Retrieve Data
    data = await CoinGeckoClient.coins.fetch(coinId, {});

    // Send embed
    fields = [
        { name:"$AUD" ,value: formatMoney(data["data"]["market_data"]["current_price"]["aud"])},
        { name:"$USD" ,value: formatMoney(data["data"]["market_data"]["current_price"]["usd"])},
        { name:"% Difference" ,value: data["data"]["market_data"]["price_change_percentage_24h"]}
    ]
    message.channel.send(printEmbed(coinName.toUpperCase(), fields, data["data"]["image"]["large"]))

    return
}
                    </code></pre>
                        <p>Input is taken from contents of message. A query is made to CoinGeckoAPI for a list of
                            all
                            coins available.
                            The result is iterated through until a match is found from the input. A 'fetch' is then
                            made
                            to CoinGeckoAPI for the matching ticker symbol.Then the data is formatted in 'fields' to
                            construct
                            an embed message for Discord.
                        </p>
                        <hr />
                        <h3>Stock Commands</h3>
                        <pre><code>	// STOCK DATA COMMAND
if (message.content.toLowerCase().includes(prefix + 'stock ')){
    
    input = message.content.toLowerCase().substr(7)

    // Get data from API
    yahooFinance.quote({
        symbol: input,
        modules: ['price', 'summaryDetail', 'summaryProfile']       // optional; default modules.
        }, function(err, quote) {
        {
            output: {
            // Output from API
            stockName = quote["price"]["shortName"]
            if (stockName == null) {
                stockName = "ERROR: No Name found"
            }
            stockPrice = quote["price"]["regularMarketPrice"]
            if (stockPrice == null) {
                stockPrice = 0
            }
            stockPercentageDiff = quote["price"]["regularMarketChangePercent"]
            if (stockPercentageDiff == null) {
                stockPercentageDiff = 0
            }
            previousClose = quote["summaryDetail"]["previousClose"]
            if (previousClose == null) {
                previousClose = 0
            }
            marketCap = quote["summaryDetail"]["marketCap"]
            if (marketCap == null) {
                marketCap = 0
            }
            volume = quote["summaryDetail"]["volume"]
            if (volume == null) {
                volume = 0
            }

            // Send embed
            fields = [
                { name:"Current Price (USD)" ,value: formatMoney(stockPrice)},
                { name:"Previous Close", value: formatMoney(previousClose)},
                { name:"Difference (%)" ,value: 100 * stockPercentageDiff},
                { name:"Market Cap" ,value: formatMoney(marketCap)},
                { name:"Volume" ,value: volume}
            ]
            message.channel.send(printEmbed(stockName, fields, usStockImg))

            }
        }
        });
                            }</code></pre>
                        <p>If a stock is requested, the input is taken from the message and treated as the correct
                            ticker for the desired stock. A quote is made to Yahoo Finance API with the input as the
                            target symbol. The modules called are 'price', 'summaryDetail', 'summaryProfile'. The
                            response from the API
                            is retrieved and checked for NULL values as this breaks the embed message. Once all data
                            is
                            collected and valid, it
                            is put together in an embed message.
                        </p>
                        <hr />
                        <h3>Random Commands</h3>
                        <pre><code class="javascript">	// RANDOM COMMANDS
if (message.content.toLowerCase().includes(prefix + 'random ')){
    
    if (message.content.toLowerCase().includes('crypto')){
        // Get list of coins
        data = await CoinGeckoClient.coins.list();
        length = data["data"].length

        // Random number within length
        i = Math.floor(Math.random() * length);

        // Find corresponding
        data["data"][i]["symbol"]
        coinId = data["data"][i]["id"]
        coinName = data["data"][i]["name"]

        // Retrieve Data
        data = await CoinGeckoClient.coins.fetch(coinId, {});

        // Send embed
        fields = [
            { name:"$AUD" ,value: "$" + formatMoney(data["data"]["market_data"]["current_price"]["aud"])} ,
            { name:"$USD" ,value: "$" + formatMoney(data["data"]["market_data"]["current_price"]["usd"])} ,
            { name:"% Difference" ,value: data["data"]["market_data"]["price_change_percentage_24h"] + "%" }
        ]
        message.channel.send(printEmbed(coinName.toUpperCase(), fields, data["data"]["image"]["large"]))
        return

    }

    if (message.content.toLowerCase().includes('stock')){
        // Read text file and randomly pick one ticker
        var text = fs.readFileSync(us_stocks_file).toString('utf-8');
        text = text.split("\n")
        randomStockTicker = text[Math.floor(Math.random() * num_of_stocks)]

        // Get Data for random stock
        yahooFinance.quote({
            symbol: randomStockTicker,
            modules: ['price', 'summaryDetail', 'summaryProfile']       // optional; default modules.
            }, function(err, quote) {
            {
                output: {
                // Output from API
                stockName = quote["price"]["shortName"]
                if (stockName == null) {
                    stockName = "ERROR: No Name found"
                }
                stockPrice = quote["price"]["regularMarketPrice"]
                if (stockPrice == null) {
                    stockPrice = 0
                }
                stockPercentageDiff = quote["price"]["regularMarketChangePercent"]
                if (stockPercentageDiff == null) {
                    stockPercentageDiff = 0
                }
                previousClose = quote["summaryDetail"]["previousClose"]
                if (previousClose == null) {
                    previousClose = 0
                }
                marketCap = quote["summaryDetail"]["marketCap"]
                if (marketCap == null) {
                    marketCap = 0
                }
                volume = quote["summaryDetail"]["volume"]
                if (volume == null) {
                    volume = 0
                }

                // Send embed
                fields = [
                    { name:"Current Price (USD)" ,value: formatMoney(stockPrice)},
                    { name:"Previous Close", value: formatMoney(previousClose)},
                    { name:"Difference (%)" ,value: 100 * stockPercentageDiff},
                    { name:"Market Cap" ,value: formatMoney(marketCap)},
                    { name:"Volume" ,value: volume}
                ]
                message.channel.send(printEmbed(stockName, fields, usStockImg))
                }
            }
            });
    }
                            }</code></pre>
                        <p>If a random crypto is requested then like above a list of all cryptos available is
                            requested
                            from
                            CoinGeckoAPI. Then a random number is selected within the length of the response. The
                            corresponding crypto to the random position in the response array is used to gather
                            required
                            data. Then, like above, data is formatted and sent in an embed message.
                        </p>
                        <p>
                            If a random stock is requested it becomes more complicated. This is because there are a
                            lot
                            more stocks to choose from and many are very small and have incomplete data. So instead
                            there is a pre-defined list of the top 800 stocks in the US Market. So in this code, we
                            read
                            the file line by line and randomly choose one. The data is then requested in a quote
                            using
                            yahoo finance API. Then like above, the data is formatted and sent in an embed message.
                        </p>
                </section>
                <hr />

                <!-- Footer -->
                <footer id="footer">
                    <!-- <ul class="icons">
                        <li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
                        <li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a>
                        </li>
                        <li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a>
                        </li>
                        <li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a>
                        </li>
                        <li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
                        <li><a href="#" class="icon solid alt fa-envelope"><span class="label">Email</span></a></li>
                    </ul> -->
                    <ul class="copyright">
                        <li>&copy; Untitled. All rights reserved.</li>
                        <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                    </ul>
                </footer>

            </div>

            <!-- Scripts -->
            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/jquery.scrolly.min.js"></script>
            <script src="assets/js/jquery.dropotron.min.js"></script>
            <script src="assets/js/jquery.scrollex.min.js"></script>
            <script src="assets/js/browser.min.js"></script>
            <script src="assets/js/breakpoints.min.js"></script>
            <script src="assets/js/util.js"></script>
            <script src="assets/js/main.js"></script>

</body>

</html>